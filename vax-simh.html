<!DOCTYPE HTML PUBLIC  "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>OpenBSD/vax on SIMH</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="description" content="the OpenBSD/vax SIMH page">
<meta name="copyright" content="This document copyright 2004-2009 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">
<a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src="images/smalltitle.gif" border="0"></a>
<p>

<h2><font color="#e00000">OpenBSD/vax on SIMH</font></h2>

<hr>

It is very easy to install OpenBSD/vax on the
<a href="http://simh.trailing-edge.com">SIMH</a> VAX simulator.  All
you need is a reasonably fast machine, enough disk space for a 1.5GB
disk image and a <i>floppyXX.fs</i> file from the OpenBSD/VAX distribution.

Assuming you're going to run SIMH on an OpenBSD system, install the
<i>emulators/simh</i> package from <a href="faq/ports/index.html">ports</a>.
Decide on an appropriate location for your OpenBSD/vax SIMH
environment and at that location, create a file <i>openbsd.simh</i>
with the following contents:

<blockquote>
<pre>
<strong>
set cpu 128m
at nvr openbsd.nvram

deposit rq qtime 1000000

set rq0 ra92
at rq0 openbsd.ra0.disk

set rq1 cdrom
at rq1 /dev/rcd0c

set rq2 cdrom
at rq2 floppy58.fs

at xq0 tap:tun0

boot cpu
exit
</strong>
</pre>
</blockquote>

For OpenBSD >5.8, replace "at xq0 tap:tun0" with "at xq0 tap:tap0".<p>

This configures SIMH to simulate a VAX with a whopping 128 MB of
memory, a RA92 1.5GB disk, a CD-ROM unit to hold CD1 of your CD-ROM
set, another CD-ROM unit to boot from, and a DELQA Qbus Ethernet
controller attached to the tun0 interface.
You might need to replace <strong>/dev/rcd0c</strong> with the
name of the raw device corresponding to your real CD-ROM unit.

<p>

By default pressing ^E will interrupt the emulation; if you're
accustomed to the emacs editing keys, you might like to remap this
(e.g. adding <strong>set console wru=1e</strong> sets it to ^6,
ascii code 0x1e).
If you prefer a larger disk, replace <strong>set rq0 ra92</strong>
with e.g. <strong>set rq0 rauser=15000</strong> (where 15000 is the
size in MB).
See the SIMH documentation for more details.

<p>

Before starting SIMH, you will need to configure the network.
In most cases, the following bridge-based configuration will give
best results:

<p>

Create the network interface, set it into layer 2 mode if necessary,
and bring it up:

<blockquote>
<pre>
# OpenBSD &lt;=5.8
# <strong>ifconfig tun0 create</strong>
# <strong>ifconfig tun0 link0</strong>
# <strong>ifconfig tun0 up</strong>

# OpenBSD >5.8
# <strong>ifconfig tap0 create</strong>
# <strong>ifconfig tap0 up</strong>
</pre>
</blockquote>

Bridge it to your ethernet interface and enable the bridge:

<blockquote>
<pre>
# OpenBSD &lt;=5.8
# <strong>ifconfig bridge0 create</strong>
# <strong>ifconfig bridge0 fwddelay 4</strong>
# <strong>ifconfig bridge0 add em0 add tun0</strong>
# <strong>ifconfig bridge0 up</strong>

# OpenBSD >5.8
# <strong>ifconfig bridge0 create</strong>
# <strong>ifconfig bridge0 fwddelay 4</strong>
# <strong>ifconfig bridge0 add em0 add tap0</strong>
# <strong>ifconfig bridge0 up</strong>
</pre>
</blockquote>

By setting appropriate permissions on /dev/tun0 or /dev/tap0 you can
avoid running SIMH as root.

<p>

802.11 wireless interfaces cannot use bridge(4) without WDS support;
in this case you can use BPF to connect to the network.
Skip the above <tt>ifconfig</tt> lines and replace the
"<tt>at xq0 tap:tun0</tt>" or "<tt>at xq0 tap:tap0</tt>" line with
a line like this, replacing iwn0 with your actual network interface
as necessary:

<blockquote><pre>
<strong>at xq0 iwn0</strong>
</pre></blockquote>

<p>

Copy the relevant <i>vax/floppyXX.fs</i> file to the location of your
OpenBSD/vax SIMH environment.

Now fire up SIMH.  At the boot prompt you should type <strong>boot
dua2:</strong>, after which SIMH should boot into the normal OpenBSD
installation program:

<blockquote>
<pre>
# <strong>simh-vax openbsd.simh</strong>

VAX simulator V3.9-0
NVR: buffering file in memory
Eth: opened OS device tun0
Loading boot code from /usr/local/lib/simh/vax/ka655x.bin


KA655-B V5.3, VMB 2.7
Performing normal system tests.
40..39..38..37..36..35..34..33..32..31..30..29..28..27..26..25..
24..23..22..21..20..19..18..17..16..15..14..13..12..11..10..09..
08..07..06..05..04..03..
Tests completed.
&gt;&gt;&gt;<strong>boot dua2:</strong>
(BOOT/R5:0 DUA2



  2..
-DUA2
  1..0..


&gt;&gt; OpenBSD/vax boot [1.16] &lt;&lt;
&gt;&gt; Press enter to autoboot now, or any other key to abort: 0
&gt; boot bsd
</pre>
</blockquote>

After you've finished the installation, restart SIMH, but now type:

<blockquote>
<pre>
&gt;&gt;&gt;<strong>boot dua0:</strong>
</pre>
</blockquote>

to boot from your newly installed disk image.  You'll need a little
patience upon your first boot, since generating the SSH host keys can
take quite a bit of time.  But it will eventually boot through and
present you with a friendly login prompt:

<blockquote>
<pre>
OpenBSD/vax (noname.my.domain) (console)

login: 
</pre>
</blockquote>

When you are done installing any additional packages, you might want
to remove the lines referring to your real CD-ROM unit and
<i>floppyXX.fs</i> from your <i>openbsd.simh</i> file.

<p>

Enjoy!

</body>
</html>
