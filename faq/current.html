<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current and using snapshots</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="copyright" content="This document copyright 2005-2017 by OpenBSD">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/current.html">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">Following <i>-current</i> and using snapshots</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[FAQ Index]</a>
</small>
</h2>
<hr>
<p>

Active OpenBSD development is known as the
<a href="faq5.html#Flavors">-current</a> branch.
These sources are frequently compiled into releases known as <i>snapshots</i>.
Active development sometimes pushes aggressive changes, and complications can
arise when building the latest code from a previous point in time.
Some of the shortcuts for getting over these hurdles are explained on this page.
In general, it's far better to use the
<!-- XXXrelease -->
<a href="upgrade61.html">OpenBSD upgrade procedure</a>
with a newer snapshot, as developers will have gone through the trouble for
you already.

<p>
Make sure you've read and understand how to
<a href="faq5.html">build the system from source</a>
before using -current and the instructions below.

<p>
You should <b>always</b> use a snapshot as the starting point for running
<i>-current</i>.
Upgrading by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.


<h3 id="r20170417">2017/04/17 - build infrastructure change</h3>

The build infrastructure has been changed to allow building <tt>clang</tt>
alongside <tt>gcc</tt>.
This requires an update of the make "include" files:

<blockquote><pre>
# <b>cd /usr/src/share/mk && make install</b>
</pre></blockquote>


<h3 id="r20170419">2017/04/19 - clang enabled for amd64 and i386</h3>

The <tt>clang</tt> compiler is now built alongside <tt>gcc</tt> on the amd64 and
i386 architectures.
It is recommended that you upgrade using a snapshot.

<p>
If you build your own releases, note that <tt>make release</tt> now needs more
than <tt>2G</tt> space on <tt>/usr/obj</tt>.
Increasing the size to <tt>3G</tt> is recommended.

<p>
If you wish to upgrade from source, you need to bootstrap <tt>clang</tt>:

<blockquote><pre>
# <b>pkg_add g++</b>
# <b>cd /usr/src/gnu/usr.bin/clang</b>
# <b>make obj</b>
# <b>make BOOTSTRAP_CLANG=yes</b>
# <b>make install</b>
</pre></blockquote>

Compile <tt>libcompiler_rt</tt>:

<blockquote><pre>
# <b>cd /usr/src/lib/libcompiler_rt</b>
# <b>make obj</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

Then do a regular <tt>make build</tt> and <tt>make release</tt>.

<h3 id="r20170427">2017/04/27 - [ports] beats updated</h3>
<tt>filebeat</tt> and <tt>packetbeat</tt> were updated to 5.3.1 which
significantly changed the configuration file layout from 1.x to 5.x. Please refer to
the <a href="https://www.elastic.co/guide/en/beats/libbeat/5.0/upgrading-1-to-5.html">upstream
documentation</a> for migrating your configuration. Also take note of
the <a href="https://www.elastic.co/guide/en/beats/libbeat/5.0/release-notes-5.0.0.html">breaking
changes</a> when upgrading to 5.3.1.
<br>
<tt>topbeat</tt> has been merged into <tt>metricbeat</tt>, a
<a href="https://www.elastic.co/guide/en/beats/libbeat/current/upgrading-1-to-5.html#_upgrading_topbeat_to_metricbeat">
migration path</a> is available.


<h3 id="r20170507">2017/05/07 - amd64: argument printing in ddb stack traces</h3>

On amd64, <a href="http://man.openbsd.org/ddb">ddb(4)</a> now supports printing
of arguments in stack traces.
This relies on the new <tt>-msave-args</tt> compiler option.
If your last upgrade predates Apr 28, you need to build a new
<a href="http://man.openbsd.org/cc">cc(1)</a> before you can build a new kernel:

<blockquote><pre>
# <b>cd /usr/src/gnu/usr.bin/cc</b>
# <b>make obj</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>


<h3 id="r20170515">2017/05/15 - breaking change for nvme(4) users with GPT</h3>

If you are booting from an <a href="http://man.openbsd.org/nvme">nvme(4)</a>
drive with a GPT disk layout, you are affected by an off-by-one in the driver
with the consequence that the sector count in your partition table may be
incorrect.
The only way to fix this is to re-initialize the partition table.
<a href="faq14.html#DupFS">Backup your data</a> to another disk
before you upgrade.
In the new <tt>bsd.rd</tt>, drop to a shell and re-initialize the GPT:

<blockquote><pre>
# <b>fdisk -iy -g -b 960 sdN</b>
</pre></blockquote>

Then do a fresh install and restore the data from the backup.

<p>
<hr>
<small>$OpenBSD: current.html,v 1.821 2017/05/15 19:12:00 tb Exp $</small>

</body>
</html>
