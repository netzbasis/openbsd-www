<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Following -current and using snapshots</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="copyright" content="This document copyright 2005-2017 by OpenBSD">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/current.html">
</head>

<body bgcolor= "#ffffff" text= "#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">Following -current and using snapshots</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[FAQ Index]</a>
</small>
</h2>
<hr>
<p>

Active OpenBSD development is known as the
<a href="faq5.html#Flavors">-current</a> branch.
These sources are frequently compiled into releases known as <i>snapshots</i>.

<p>
Aggressive changes are sometimes pushed in this branch, and complications can
arise when building the latest code or upgrading from a previous point in time.
Some of the steps for getting over these hurdles are explained on this page.
Make sure you've read and understand how to
<a href="faq5.html">build the system from source</a> before using -current
and the instructions below.

<p>
In general, it's far easier to use snapshots, as developers will have gone
through much of the trouble for you already.

<p>
You should <b>always</b> use a snapshot as the starting point for running
-current.
This process typically consists of downloading (and verifying) the appropriate
<a href="faq4.html#bsd.rd">bsd.rd</a> file from the <tt>/snapshots/</tt>
directory of your preferred <a href="../ftp.html">mirror</a>, booting from it,
and choosing <tt>(U)pgrade</tt> at the prompt.
Any installed packages should then be
<a href="faq15.html#PkgUpdate">upgraded</a> after booting into the new system.

<p>
Upgrading to -current by compiling your own source code is not supported.

<p>
Most of these changes will have to be performed as root.


<h3 id="r20180404">2018/04/04 - PF_TRANS_ALTQ removed</h3>

The obsolete <tt>PF_TRANS_ALTQ</tt> has been removed from <tt>net/pfvar.h</tt>.
Several userland programs will need to be recompiled together with the kernel.
Using a snapshot is highly recommended.  To update from source, the following
steps are needed:

<ol>
<li>
Build and install the kernel but do <b>NOT</b> reboot.

<li>
Rebuild the affected programs:

<blockquote><pre>
# <b>cd /usr/src && make includes</b>
# <b>cd /usr/src/sbin/pfctl && make clean && make && make install</b>
# <b>cd /usr/src/usr.sbin/authpf && make clean && make && make install</b>
# <b>cd /usr/src/usr.sbin/ftp-proxy && make clean && make && make install</b>
# <b>cd /usr/src/usr.sbin/relayd && make clean && make && make install</b>
# <b>cd /usr/src/usr.sbin/tftp-proxy && make clean && make && make install</b>
</pre></blockquote>

<li> Reboot.
</ol>


<h3 id="r20180411">2018/04/11 - meaning of listen on * port 80 changed
in httpd(8)</h3>

The meaning of <tt>listen on * port 80</tt> changed from "listen on
all IPv4 addresses" to "listen on all IPv4 <b>and</b> all IPv6 addresses".
If <tt>listen on * port 80</tt> is present, <tt>listen on :: port 80</tt>
needs to be removed.
For example,

<blockquote><pre>
listen on * port 80
listen on :: port 80
</pre></blockquote>

must be changed to:

<blockquote><pre>
listen on * port 80
</pre></blockquote>


<h3 id="r20180420">2018/04/20 - [packages] security/kc storage format change</h3>

The storage format of keychains has changed in a backward incompatible way.
Dump all your keychains to xml before updating:

<blockquote><pre>
$ <b>kc -k ~/.kc/default.kcd</b>
Password:
&lt;example_chain% &gt; <b>dump kcdump</b>
Dump OK
&lt;example_chain% &gt; <b>quit</b>
</pre></blockquote>

After updating follow the instructions in
<tt>/usr/local/share/doc/kc/Changelog</tt>.


<h3 id="r20180503">2018/05/03 - [packages] sysutils/apcupsd has SMTP client removed</h3>

The <tt>${PREFIX}/sbin/smtp</tt> was removed from apcupsd package
in favor of <a href="https://man.openbsd.org/smtp.1">smtp(1)</a>.
The programs are not option-compatible, so any scripts using &quot;smtp&quot;
command require adjustment.


<h3 id="r20180503">2018/05/22 - [packages] PHP default version changed</h3>

With a few exceptions, most packages using PHP have switched to
using PHP 7.0 dependencies by default.
Because extension modules (now including PECL modules) are packaged
for multiple PHP versions, most existing PHP programs will work as-is,
but to avoid confusion and benefit from improvements to PHP you should
switch your system across:

<ol>
<li>Merge local configuration changes from /etc/php-5.6.ini
to /etc/php-7.0.ini.
It may be useful to diff(1) against the original file in
/usr/local/share/examples/php-5.6/php.ini-production.

<li>Create new symlinks for extension modules as described in
the "extension modules" section of /usr/local/share/doc/pkg-readmes/php-7.0*.

<li>Switch to running the new version. If using php-fpm:
<blockquote><pre>
$ <b>rcctl disable php56_fpm; rcctl enable php70_fpm</b>
$ <b>rcctl stop php56_fpm; rcctl start php70_fpm</b>
</blockquote>
If using the module for Apache httpd, update the symlink for
/var/www/conf/modules/php.conf as shown in the pkg-readme.
</ol>

<h3 id="r20180524">2018/05/24 - smtpd.conf(5) grammar has changed in smtpd(8)</h3>

The <a href="https://man.openbsd.org/smtpd.conf.5">smtpd.conf(5)</a> file needs to
be adapted to use the new grammar.

<p>
The change is mostly mechanical and requires splitting current rules into actions
and matching patterns, examples are available in the man page.

<p>
Authenticated users are no longer considered as local users,
if your configuration file allows remote users to authenticate and send mail,
an explicit rule must be written to match these.

<p>
<a href="https://man.openbsd.org/smtpd.8">smtpd(8)</a> supported LMTP both as a
relaying protocol and as a local delivery method. The local delivery method was
implemented within the daemon and not as an MDA, it no longer does and must be
used through the 'mda' action:

<blockquote><pre>
action lmtp-local mda "/usr/libexec/mail.lmtp [...]
</pre></blockquote>

The <a href="https://man.openbsd.org/mail.lmtp.8">mail.lmtp(8)</a> MDA provides
all the features that used to be supported interally by
<a href="https://man.openbsd.org/smtpd.8">smtpd(8)</a>.


<hr id="end">
<small>$OpenBSD: current.html,v 1.899 2018/05/26 06:09:43 gilles Exp $</small>

</body>
</html>
