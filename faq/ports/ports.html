<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>1 - The OpenBSD ports system</title>
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD ports system">
<meta name= "keywords"      content= "openbsd,ports">
<meta name= "distribution"  content= "global">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>

<!--
Copyright (c) 2005-2010 Steven Mestdagh <steven@openbsd.org>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<!-- Passes validator.w3.org.  Please keep it this way -->

<body bgcolor= "#ffffff" text= "#000000">

<a href="../../index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>

<p>
<font color= "#0000e0">
<a href="index.html">[Handbook Index]</a>
<a href="guide.html">[To Section 2 - OpenBSD Porting Guide]</a>
</font>

<h1><font color="#e00000">1 - The OpenBSD ports system</font></h1><hr>

<h3>Table of Contents</h3>
<ul>
  <li><a href="#PortsHow"     >1.1 - How does it work?</a>
  <li><a href="#PortsFetch"   >1.2 - Fetching the ports tree</a>
  <li><a href="#PortsConfig"  >1.3 - Configuration of the ports system</a>
  <li><a href="#PortsSearch"  >1.4 - Searching the ports tree</a>
  <li><a href="#PortsInstall" >1.5 - A first example</a>
  <li><a href="#PortsClean"   >1.6 - Cleaning up after a build</a>
  <li><a href="#PortsDelete"  >1.7 - Uninstalling a port's package</a>
  <li><a href="#PortsFlavors" >1.8 - Using flavors and subpackages</a>
  <li><a href="#PortsHelp"    >1.9 - Problems and Contacts</a>
  <li><a href="#PortsLag"     >1.10 - When a Port Is Lagging Behind the Mainstream Version</a>
</ul>

<hr>

<a name="PortsHow"></a>
<h2>1.1 - How does it work?</h2>

The ports tree, a concept originally borrowed from
<a href="http://www.freebsd.org/">FreeBSD</a>, is a set of Makefiles,
one for each third party application, for controlling

<ul>
<li>where and how to fetch the source of the software,
<li>which other software it depends upon,
<li>how to alter the sources (if necessary),
<li>how to configure and build it,
<li>how to test it (optional),
<li>how to install it.
</ul>

<p>
Apart from the <tt>Makefile</tt>, each port also contains at least the
following:

<ul>
<li>a <tt>PLIST</tt> or packing list, which contains instructions for package
creation once the application has been built,
<li>a <tt>DESCR</tt> or description of the application,
<li>a <tt>distinfo</tt>, containing distribution file checksums and size.
</ul>

<p>
All this information is kept in a directory hierarchy under
<tt>/usr/ports</tt>.
This hierarchy contains three special subdirectories:
<ul>
<li><tt>distfiles/</tt> - where the ports system stores
software distribution sets after downloading.
<li><tt>infrastructure/</tt> - the main directory of the ports
infrastructure, containing all necessary scripts and makefiles.
<li><tt>packages/</tt> - contains all binary packages built by the ports
system.
</ul>
The other subdirectories all form different application categories,
which contain the subdirectories of the actual ports.
Complex ports may be organized to an even deeper level, for example if
they have a core part and a set of extensions, or a stable and a snapshot
version of the application.
Every port directory must contain a <tt>pkg/</tt> subdirectory containing
packing list(s) and description file(s).
There may also be <tt>patches/</tt> and <tt>files/</tt> subdirectories,
for source patches and additional files, respectively.

<p>
When a user issues
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">make(1)</a>
in the subdirectory of a specific port, the system will recursively
walk its dependency tree, check whether the required dependencies are
installed, build and install any missing dependencies, and then
continue the build of the desired port.
All of the building happens inside the <i>working directory</i> that
the port creates.
Normally it is under <tt>${WRKOBJDIR}</tt>, defaulting to
<tt>/usr/ports/pobj</tt>, but you may override this (see
<a href="#PortsConfig">Configuration of the ports system</a>).
If <tt>WRKOBJDIR</tt> has been explicitly unset, a subdirectory
of the port's main directory (package name prefixed by "w-") will be
used instead.

<p>
<b>Note:</b> Ports are never directly installed on your system!
They use a <i>fake installation directory</i>.
Everything that gets installed there, is bundled together into a
package (which is stored in the <tt>packages/</tt> subdirectory of the
ports tree as mentioned earlier).
Installing a port really means: creating a package, and then
installing that package!

<p>
<b>More information</b> about the ports system may be found in these
manual pages:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ports&amp;sektion=7">ports(7)</a>
- describes the different stages (make targets) of port installation,
the use of flavors and subpackages and some other options.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5">bsd.port.mk(5)</a>
- in depth information about all the make targets, variables, the fake
(installation directory) framework, etc.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=port-modules&amp;sektion=5">port-modules(5)</a>
- format and conventions used in port modules.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=packages-specs&amp;sektion=7">packages-specs(7)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=library-specs&amp;sektion=7">library-specs(7)</a>
- specifications for binary package names and library dependencies,
respectively.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_create&amp;sektion=1">pkg_create(1)</a>
- notation used in packing lists.
</ul>

<a name="PortsFetch"></a>
<h2>1.2 - Fetching the ports tree</h2>

<p>
The ports tree, like the rest of OpenBSD, is constantly changing.
The current ports tree <b>may not</b> be used with the previous
release.  This is due to changes, typically with the port make process,
that require code based upon the OpenBSD-current source tree.
<p>The ports tree works as a single entity. Updating a single directory is
not guaranteed to work, as package dependencies may force you to update
and recompile vast portions of the ports tree.
It is strongly suggested that people don't track ports-current unless
they're prepared to deal with various problems.
<a href="../../mail.html">Mailing lists</a> such as
<tt>ports-changes@openbsd.org</tt> or
<tt>tech@openbsd.org</tt> will probably be invaluable.

<p>
Before continuing, you must therefore read the section about
<a href="../faq15.html#NoFun">NOT mixing up your OpenBSD system
and ports tree</a>.
Once you have decided which <a href="../faq5.html#Flavors">flavor</a>
of the ports tree you want, you can get the ports tree from different
sources.
The table below gives an overview of where you can find the different
flavors, and in which form.
An 'x' marks availability and '-' means it is not available through
that specific source.

<p>
<table border="1" align="center" style="empty-cells: show;">
<tr align="center">
<td align="left">Source</td>
<td>Form</td>
<td colspan="4">Flavor</td>
</tr>
<tr align="center">
<td colspan="2"></td>
<td>-release</td>
<td>-stable</td>
<td>snapshots</td>
<td>-current</td>
</tr>
<tr align="center">
<td align="left"><a href="../../orders.html">CD-ROM</a></td>
<td>.tar.gz</td>
<td>x</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr align="center">
<td align="left"><a href="../../ftp.html">FTP mirrors</a></td>
<td>.tar.gz</td>
<td>x</td>
<td>-</td>
<td>x</td>
<td>-</td>
</tr>
<tr align="center">
<td align="left"><a href="../../anoncvs.html">AnonCVS</a></td>
<td>cvs checkout</td>
<td>x</td>
<td>x</td>
<td>-</td>
<td>x</td>
</tr>
</table>

<p>
On the CD-ROM and mirrors, look for a file named <tt>ports.tar.gz</tt>.
You want to untar this file in the <tt>/usr</tt> directory, which will
create <tt>/usr/ports</tt>, and all the directories under it.
For example:

<blockquote><pre>
$ <b>cd /tmp</b>
$ <b>ftp http://ftp.openbsd.org/pub/OpenBSD/5.5/ports.tar.gz</b>
$ <b>ftp http://ftp.openbsd.org/pub/OpenBSD/5.5/SHA256.sig</b>
$ <b>signify -C -p /etc/signify/openbsd-55-base.pub -x SHA256.sig ports.tar.gz</b>
$ <b>cd /usr</b>
$ <b>sudo tar xzf /tmp/ports.tar.gz</b>
</pre></blockquote>

<p>
The snapshots available on the mirrors are generated daily from
the -current ports tree.
You will find the snapshots in the <tt>pub/OpenBSD/snapshots/</tt>
directory.
If you are using a snapshot of the ports tree, you should have
installed a matching snapshot of OpenBSD.
Make sure you keep your ports tree and your OpenBSD system in sync!

<p>
The ports-current tree can be retrieved via:
<ul>
<li><a href="../../anoncvs.html">Anonymous CVS</a> (see link).
The command is essentially <tt><b>cvs get ports</b></tt>.
You can also use this method to retrieve the tree from a local
<a href="../../cvsync.html">cvsync</a> mirror.
<li>Download from
<a href="http://ftp.openbsd.org/pub/OpenBSD/snapshots/ports.tar.gz">
http://ftp.openbsd.org/pub/OpenBSD/snapshots/ports.tar.gz</a>.
        This archive is updated nightly.
<li>Your web browser using the
<a href="http://cvsweb.openbsd.org/cgi-bin/cvsweb/ports/">CVS
        web interface</a>.
</ul>


<a name="PortsConfig"></a>
<h2>1.3 - Configuration of the ports system</h2>

<p>
<b>NOTE:</b>
This section introduces some additional global settings for building
applications from ports.
You can skip this section, but then you will be required to perform many
of the make(1) statements in the examples as root.

<p>
Because the OpenBSD project does not have the resources to fully review
the source code of all software in the ports tree, you can configure the
ports system to take a few safety precautions.
The ports infrastructure is able to perform all building as a regular user,
and perform only those steps that require superuser privileges as root.
Examples are the <tt>fake</tt> and <tt>install</tt> make targets.
However, because root privileges are always required at some point,
the ports system will not save you when you decide to build a malicious
application.

<p>
<ul>
<li>You can set up
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
and have the ports system use it for tasks requiring superuser permissions.
This requires granting three permissions:

  <ul>
  <li>The user who is going to build ports needs permission
  to run arbitrary commands as the superuser,
  see the "User Specification" subsection in the 
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudoers&amp;sektion=5">sudoers(5)</a> manual.

  <li>The user who is going to build ports needs permission
  to pass certain environment variables used by the ports system
  from the shell calling sudo to the privileged shell,
  see the <tt>env_keep</tt> variable in
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudoers&amp;sektion=5">sudoers(5)</a>.
  The default file <tt>/etc/sudoers</tt> already provides an appropriate
  list of variables for members of the <tt>wsrc</tt> group, so it is
  usually sufficient to add the user who is going to build ports to that
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=5">group(5)</a>.

  <li>The ports system needs permission to invoke sudo.
  This can be granted by setting the <tt>SUDO</tt> variable defined in
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5">bsd.port.mk(5)</a>
  in the environment, which can be made permanent
  by adding the following line to to
  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mk.conf&amp;sektion=5">mk.conf(5)</a>:
  <blockquote><pre>
  SUDO=/usr/bin/sudo
  </pre></blockquote>
  </ul>

<li>You can modify the ownerships of the ports tree so that you can write
there as a regular user.
In this case, the regular user has been added to the wsrc group, and the
underlying directories are made group writable.

<blockquote><pre>
# <b>chgrp -R wsrc /usr/ports</b>
# <b>find /usr/ports -type d -exec chmod g+w {} \;</b>
</pre></blockquote>

<li>You can have the ports system use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=systrace&amp;sektion=1">systrace(1)</a>
by adding the following to <tt>/etc/mk.conf</tt>

<blockquote><pre>
USE_SYSTRACE=Yes
</pre></blockquote>

This enforces the build procedure to stay inside allowed directories, and
prohibits writing in illegal places, thereby considerably reducing the risk
of a damaged system.
Note that the use of systrace(1) adds about 20% overhead in build time.

</ul>

<p>
It is possible to use a read-only ports tree by separating directories
that are written to during port building:

<ul>
<li>The working directory of ports.
This is controlled by the <tt>WRKOBJDIR</tt> variable, which specifies
the directory which will contain the working directories.
<li>The directory containing distribution files.
This is controlled by the <tt>DISTDIR</tt> variable.
<li>The directory containing newly built binary packages.
This is controlled by the <tt>PACKAGE_REPOSITORY</tt> variable.
</ul>

For example, you could add the following lines to <tt>/etc/mk.conf</tt>

<blockquote><pre>
WRKOBJDIR=/usr/obj/ports
DISTDIR=/usr/distfiles
PACKAGE_REPOSITORY=/usr/packages
</pre></blockquote>

If desired, you can also change the ownership of these directories to your
local username and group, so that the ports system can create underlying
working directories as a regular user.


<a name="PortsSearch"></a>
<h2>1.4 - Searching the ports tree</h2>

Once you have the ports tree in place on your system, it becomes very
easy to search for software.
Just use <tt><b>make search key="searchkey"</b></tt>, as shown in the
following example.

<blockquote><pre>
$ <b>cd /usr/ports</b>
$ <b>make search key=rsnapshot</b>
Port:	rsnapshot-1.3.1p2
Path:	net/rsnapshot
Info:	remote filesystem snapshot utility
Maint:	Antoine Jacoutot &lt;ajacoutot@openbsd.org&gt;
Index:	net sysutils
L-deps:	
B-deps:	STEM-&gt;=1.21:textproc/groff net/rsync
R-deps:	devel/p5-Lchown net/rsync
Archs:	any
</pre></blockquote>

The search result gives a nice overview of each application that is
found: the port name, the path to the port, a one-line description, the
port's maintainer, keywords related to the port, library/build/runtime
dependencies, and architectures on which the port is known to work.

<p>
One can also use the index file to go directly to a given port:
<blockquote><pre>
$ <b>cd /usr/ports</b>
$ <b>make key=rsnapshot describe</b>
===&gt;&gt; net/rsnapshot
rsnapshot-1.3.1p2|net/rsnapshot||remote filesystem snapshot utility|net/rsnapshot/pkg/DESCR|Antoine Jacoutot &lt;ajacoutot@openbsd.org&gt;|net sysutils||STEM-&gt;=1.21:textproc/groff net/rsync|devel/p5-Lchown net/rsync|any|y|y|y
</pre></blockquote>

<p>
This mechanism, however, is a very basic one, which just runs awk(1)
on the ports index file.
Fine-grained searching using SQL is also available using the port called
<tt>sqlports</tt>.
It is a SQLite database, but basically just about any database format can be
created using the ports infrastructure.
The <tt>sqlports</tt> port includes the script used to generate the database,
which could be used as a basis to generate databases in different formats.

<p>
A sample session could look like:

<blockquote><pre>
$ <b>sqlite3 /usr/local/share/sqlports</b>
SQLite version 3.8.0.2 OpenBSD
Enter ".help" for instructions
Enter SQL statements terminated with a ";"
sqlite&gt; <b>SELECT FULLPKGNAME,COMMENT FROM Ports WHERE COMMENT LIKE '%statistics%';</b>
pg_statsinfo-2.4.1p0|monitor PostgreSQL activity &amp; statistics
erl-bear-0.1.3p0|set of statistics functions for Erlang
p5-Devel-Cover-Report-Clover-0.35|backend for Clover reporting of coverage statistics
mailgraph-1.14p1|RRDtool frontend for Postfix statistics
R-2.15.3p0|powerful math/statistics/graphics language
p5-Math-VecStat-0.08p0|provides basic statistics on numerical vectors
py-probstat-0.912p7|probability and statistics utilities for Python
darkstat-3.0.718|network statistics gatherer with graphs
pfstat-2.3p5|packet filter statistics visualization
rtg-0.7.4p8|SNMP statistics monitoring system
slurm-0.3.3p1|network traffic monitor and statistics
tcpstat-1.5p0|report network interface statistics
wmwave-0.4p3|Window Maker dockapp to display wavelan statistics
libstatgrab-0.17|system statistics gathering library
p5-Unix-Statgrab-0.04p4|interface to libstatgrab system statistics library
diffstat-1.55|accumulates and displays statistics from a diff file
drupal7-google_analytics-1.2p0|add the Google Analytics web statistics to your site
kdf-4.11.5|KDE storage device statistics
sqlite&gt;
</pre></blockquote>

The above is still a very basic search.
With SQL, just about anything can be searched for, including dependencies,
configure flags, shared libraries, etc.

<a name="PortsInstall"></a>
<h2>1.5 - A first example</h2>

Let's illustrate the main concepts of the ports system with a simple example:
<tt>rsnapshot</tt>.
To build this application we will go into its directory and execute
<tt><b>make install</b></tt>.
The results should look something like the following:

<blockquote><pre>
$ <b>cd /usr/ports/net/rsnapshot</b>
$ <b>make install</b>
===&gt;  Checking files for rsnapshot-1.3.1p2
`/usr/ports/distfiles/rsnapshot-1.3.1.tar.gz' is up to date.
&gt;&gt; (SHA256) rsnapshot-1.3.1.tar.gz: OK
===&gt; rsnapshot-1.3.1p2 depends on: rsync-* - not found
===&gt;  Verifying install for rsync-* in net/rsync
===&gt;  Checking files for rsync-3.1.0
`/usr/ports/distfiles/rsync-3.1.0.tar.gz' is up to date.
&gt;&gt; (SHA256) rsync-3.1.0.tar.gz: OK
===&gt;  Verifying specs: c z c z
===&gt;  found c.73.1 z.5.0
===&gt;  Extracting for rsync-3.1.0
===&gt;  Patching for rsync-3.1.0
===&gt;  Configuring for rsync-3.1.0
  [...snip...]
===&gt;  Building for rsync-3.1.0
  [...snip...]
===&gt;  Faking installation for rsync-3.1.0
  [...snip...]
===&gt;  Building package for rsync-3.1.0
Create /usr/ports/packages/amd64/all/rsync-3.1.0.tgz
Link to /usr/ports/packages/amd64/ftp/rsync-3.1.0.tgz
Link to /usr/ports/packages/amd64/cdrom/rsync-3.1.0.tgz
===&gt;  Cleaning for rsync-3.1.0
===&gt;  Verifying specs: c z
===&gt;  found c.73.1 z.5.0
===&gt;  Installing rsync-3.1.0 from /usr/ports/packages/amd64/all/
rsync-3.1.0: ok
The following new rcscripts were installed: /etc/rc.d/rsyncd
See rc.d(8) for details.
===&gt; Returning to build of rsnapshot-1.3.1p2
===&gt; rsnapshot-1.3.1p2 depends on: rsync-* -&gt; rsync-3.1.0
===&gt; rsnapshot-1.3.1p2 depends on: groff-&gt;=1.21 -&gt; groff-1.22.2p4
===&gt;  Extracting for rsnapshot-1.3.1p2
===&gt;  Patching for rsnapshot-1.3.1p2
===&gt;  Configuring for rsnapshot-1.3.1p2
  [...snip...]
===&gt;  Building for rsnapshot-1.3.1p2
  [...snip...]
===&gt;  Faking installation for rsnapshot-1.3.1p2
  [...snip...]
===&gt;  Building package for rsnapshot-1.3.1p2
Create /usr/ports/packages/amd64/no-arch/rsnapshot-1.3.1p2.tgz
Link to /usr/ports/packages/amd64/all/rsnapshot-1.3.1p2.tgz
Link to /usr/ports/packages/amd64/ftp/rsnapshot-1.3.1p2.tgz
Link to /usr/ports/packages/amd64/cdrom/rsnapshot-1.3.1p2.tgz
===&gt; rsnapshot-1.3.1p2 depends on: p5-Lchown-* -&gt; p5-Lchown-1.01p2
===&gt;  Installing rsnapshot-1.3.1p2 from /usr/ports/packages/amd64/all/
rsnapshot-1.3.1p2: ok
</pre></blockquote>

<p>
Pretty easy, huh? Especially considering all the things the ports system takes care
of automatically:
<ul>
<li>Fetch the sources from an ftp site (saved under <tt>/usr/ports/distfiles/</tt>),
<li>Check the source archive integrity,
<li>Extract the sources,
<li>Apply OpenBSD specific patches,
<li>Configure and build (compile) the program,
<li>Install the files into a fake directory
<li>Create a binary package under <tt>/usr/ports/packages/</tt>,
<li>Install that package (usually under <tt>/usr/local/</tt>).
</ul>

And this is done recursively <b>for all dependencies</b> of the port.
Just notice the
"<tt>===&gt; Verifying install for ...</tt>" and
"<tt>===&gt; Returning to build of ...</tt>" lines in the above output,
indicating the walk through the dependency tree.

<p>
If a previous version of the application you want to install, was
already installed on your system, you can use <tt><b>make
update</b></tt> instead of <tt><b>make install</b></tt>.
This will call pkg_add(1) with the <tt>-r</tt> flag.

<p>
<b>Note:</b>
Large applications will require a lot of system resources to build.
Good examples are compilers like GCC 4.0 or the Java 2 Software
Development Kit.
If you get "out of memory" type of errors when building such a port,
this usually has one of two causes:

<ul>
<li>Your resource limits are too restrictive.
Adjust them with ksh's ulimit or csh's limit command.
If that doesn't help, just become root before starting the build, or use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
with the <tt>-c</tt> flag to run the build with the resources limited
by the specified login class (refer to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5">login.conf(5)</a>
for details about login classes).
<li>You simply don't have enough RAM in your machine.
</ul>

<p>
<b>Tips:</b>
<ul>
<li>Users with low connectivity may refer to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mirroring-ports&amp;sektion=7&amp;format=html">mirroring-ports(7)</a> for
an efficient way to grab all distfiles at once.
<li>In OpenBSD-current, you can use the script
<tt>/usr/ports/infrastructure/fetch/clean-old</tt> to track old distfiles.
</ul>


<a name="PortsClean"></a>
<h2>1.6 - Cleaning up after a build</h2>

You probably want to clean the port's default working directory after
you have built the package and installed it.

<blockquote><pre>
$ <b>make clean</b>
===&gt;  Cleaning for rsnapshot-1.2.9
</pre></blockquote>

In addition, you can also clean the working directories of all
dependencies of the port with this make target:

<blockquote><pre>
$ <b>make clean=depends</b>
===&gt;  Cleaning for rsync-2.6.9
===&gt;  Cleaning for rsnapshot-1.2.9
</pre></blockquote>

If you wish to remove the source distribution set(s) of the port, you
would use

<blockquote><pre>
$ <b>make clean=dist</b>
===&gt;  Cleaning for rsnapshot-1.2.9
===&gt;  Dist cleaning for rsnapshot-1.2.9
</pre></blockquote>

In case you have been compiling multiple flavors of the same port,
you can clear the working directories of all these flavors at once using

<blockquote><pre>
$ <b>make clean=flavors</b>
</pre></blockquote>

You can also clean things up as they get built, by setting a special variable.
Work directories will automatically be cleaned after packages have been
created:
<blockquote><pre>
$ <b>make package BULK=Yes</b>
</pre></blockquote>

<a name="PortsDelete"></a>
<h2>1.7 - Uninstalling a port's package</h2>

It is very easy to uninstall a port:

<blockquote><pre>
$ <b>make uninstall</b>
===&gt; Deinstalling for rsnapshot-1.2.9
rsnapshot-1.2.9: complete
Clean shared items: complete
</pre></blockquote>

This will call pkg_delete(1) to have the corresponding package removed
from your system.
If desired, you can also uninstall and re-install a port's package by
using

<blockquote><pre>
$ <b>make reinstall</b>
===&gt;  Cleaning for rsnapshot-1.2.9
/usr/sbin/pkg_delete rsnapshot-1.2.9
rsnapshot-1.2.9: complete
Clean shared items: complete
===&gt;  Installing rsnapshot-1.2.9 from /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
rsnapshot-1.2.9: complete
</pre></blockquote>

If you would like to get rid of the packages you just built, you can do so
as follows:

<blockquote><pre>
$ <b>make clean=packages</b>
===&gt;  Cleaning for rsnapshot-1.2.9
rm -f /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
</pre></blockquote>

<a name="PortsFlavors"></a>
<h2>1.8 - Using flavors and subpackages</h2>

Please do read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ports&amp;sektion=7">ports(7)</a>
manual page, which gives a good overview of this topic.
There are two mechanisms to control the packaging of software according
to different needs.

<p>
The first mechanism is called <b>flavors</b>.
A flavor usually indicates a certain set of compilation options.
For instance, some applications have a "no_x11" flavor which can be used on
systems without X.
Some shells have a "static" flavor, which will build a statically linked
version.
There are ports which have different flavors for building them with
different graphical toolkits.
Other examples include: support for different database formats,
different networking options (SSL, IPv6, ...), different paper sizes, etc.

<p>
<b>Summary:</b>
Most likely you will use flavors when a package has not been made
available for the flavor you are looking for.
In this case you will specify the desired flavor and build the port
yourself.

<p>
Most port flavors have their own working directory during building
and every flavor will be packaged into a correspondingly named package to
avoid any confusion.
To see the different flavors of a certain port, you would change to its
subdirectory and issue

<blockquote><pre>
$ <b>make show=FLAVORS</b>
</pre></blockquote>

You should also look at the port's <tt>DESCR</tt> files, as they're supposed to
explain the available flavors.

<p>
The second mechanism is called <b>subpackages</b>.
A porter may decide to create subpackages for different pieces of the
same application, if they can be logically separated.
You will often see subpackages for the client part and the server part
of a program.
Sometimes extensive documentation is bundled in a separate subpackage
because it takes up quite some disk space.
Extra functionality that pulls in heavy dependencies will often be
packaged separately.
The porter will also decide which subpackage is the main subpackage,
to be installed as a default.
Other examples are: extensive test suites which come with the software,
separate modules with support for different things, etc.

<p>
<b>Summary:</b>
Some ports are split into several packages.
<tt><b>make install</b></tt> will only install the main subpackage.

<p>
To list the different packages built by a port, use
<blockquote><pre>
$ <b>make show=PACKAGES</b>
</pre></blockquote>
<p>

<tt><b>make install</b></tt> will only install the main subpackage.
To install them all, use

<blockquote><pre>
$ <b>make install-all</b>
</pre></blockquote>
<p>

To list the different subpackages available for a port, use

<blockquote><pre>
$ <b>make show=MULTI_PACKAGES</b>
</pre></blockquote>

It is possible to select which subpackage(s) to install from within the
ports tree.
After some tests, this procedure will just call
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+5.4">pkg_add(1)</a>
to install the desired subpackage(s).

<blockquote><pre>
$ <b>env SUBPACKAGE="-server" make install</b>
</pre></blockquote>

<p>
<b>Note:</b>
The subpackages mechanism only handles packages, it does not modify any
configuration options before building the port.
For that purpose you must use flavors.





<a name="PortsHelp"></a>
<h2>1.9 - Problems and Contacts</h2>

<p>
If you have trouble with an existing port, please send e-mail to the
port maintainer. To see who is the maintainer of the port, type, for
example:

<blockquote><pre>
$ <b>cd /usr/ports/archivers/unzip</b>
$ <b>make show=MAINTAINER</b>
</pre></blockquote>

Alternatively, if there is no maintainer, or you can't reach
him/her, send mail to the OpenBSD
ports mailing list, <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>.
Please don't use the misc@openbsd.org mailing list for questions about ports.
Corrections are always welcome, but in any case do please provide:
<ul>
<li>The output of <tt><b>uname -a</b></tt>,
<li>Your OpenBSD version, including any patches you may have applied,
<li>A complete description of the problem.
</ul>
For ports that don't build correctly, a complete build transcript is almost
always required. You can use the portslogger(1) script, found in
<tt>/usr/ports/infrastructure/bin</tt>, for this.
A sample run of portslogger(1) might be:

<blockquote><pre>
$ <b>cd /usr/ports/archivers/unzip</b>
$ <b>su</b>
# <b>mkdir -p ~/portslogs</b>
# <b>make clean install 2>&amp;1 | /usr/ports/infrastructure/bin/portslogger \</b>
        <b>~/portslogs</b>
</pre></blockquote>

After this, you should have a logfile of the build in your <tt>~/portslogs</tt>
directory that you can send to the port maintainer.
Also, make sure you are not using any special options in your build, for example
in <tt>/etc/mk.conf</tt>.

<p>
Alternatively, you can
<ul>
<li>Use <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=script&amp;sektion=1&amp;format=html">script(1)</a> to create a complete build transcript. Don't remove the configure information.
    <li>Attach the output of <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_info&amp;sektion=1&amp;format=html">pkg_info(1)</a> if it seems even remotely relevant.
    <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc&amp;sektion=1&amp;format=html">gcc(1)</a> internal  compiler errors do ask you to report the bug to
the gcc mailing-list. It does save time if you follow their direction, and
provide at least the various files produced by <tt><b>gcc -save-temps</b></tt>.
</ul>


<a name="PortsLag"></a>
<h2>1.10 - When a Port Is Lagging Behind the Mainstream Version</h2>

<p>
The ports collection is a volunteer project. Sometimes the project simply
doesn't have the developer resources to keep everything up-to-date.
Developers pretty much pick up what they consider interesting and can
test in their environment. Your <a href="../../goals.html#funding">donations</a>
count for what platforms the ports can be tested on.


<p>
Some individual ports may lag behind the mainstream versions because of this.
The ports collection may have a version back of a program from January while a new
version of the program has been released by its developers in May three months ago.
Often this is a conscious decision; the new version may have problems in it on
OpenBSD that the maintainer is trying to solve, or that have simply made the
application worse than the old version: OpenBSD may have different
<a href="../../goals.html">goals</a> than the mainstream developers in other projects,
which sometimes results in features and design or implementation choices
that are undesirable from OpenBSD developers' point of view. The update may also be
postponed because the new version is not considered a crucial update.


<p>
If you really need a new version of a port, you should ask the <tt>MAINTAINER</tt>
of the port to update the port (see <a href="#PortsHelp">above</a> on how to find out who
the maintainer is); if you can send patches for this, all the better.





<p>

<font color= "#0000e0">
<a href="index.html">[Handbook Index]</a>
<a href="guide.html">[To Section 2 - OpenBSD Porting Guide]</a>
</font>

<p>
<hr>
<a href="../index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<br>
<small>$OpenBSD: ports.html,v 1.27 2014/11/10 09:29:52 sthen Exp $</small>

</body>
</html>
