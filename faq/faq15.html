<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD FAQ: Packages and Ports</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="copyright" content="This document copyright 1999-2017 by OpenBSD.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/faq15.html">
</head>

<!--
Copyright (c) 2005-2009 Steven Mestdagh <steven@openbsd.org>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor= "#ffffff" text= "#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">FAQ - Packages and Ports</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[FAQ Index]</a>
</small>
</h2>
<hr>

<!-- sync any table of contents changes with faq/ports/index.html -->
<ul>
<li><a href="#Intro"          >Introduction</a>
<li><a href="#PkgMgmt"        >Package management</a>
  <ul>
  <li><a href="#PkgHow"       >How does it work?</a>
  <li><a href="#Mirror"       >Selecting a mirror</a>
  <li><a href="#PkgFind"      >Finding packages</a>
  <li><a href="#PkgInstall"   >Installing new packages</a>
  <li><a href="#PkgUpdate"    >Updating installed packages</a>
  <li><a href="#PkgRemove"    >Removing installed packages</a>
  <li><a href="#PkgPartial"   >Incomplete package installation or removal</a>
  </ul>
<li><a href="#Ports"          >Working with ports</a>
  <ul>
  <li><a href="#PortsHow"     >How does it work?</a>
  <li><a href="#PortsFetch"   >Fetching the ports tree</a>
  <li><a href="#PortsConfig"  >Configuration of the ports system</a>
  <li><a href="#PortsSearch"  >Searching the ports tree</a>
  <li><a href="#PortsInstall" >Straightforward installation:
                               a simple example</a>
  <li><a href="#PortsClean"   >Cleaning up after a build</a>
  <li><a href="#PortsDelete"  >Uninstalling a port's package</a>
  <li><a href="#PortsFlavors" >Using flavors and subpackages</a>
  <li><a href="#dpb"          >Using dpb to build multiple ports</a>
  <li><a href="#PortsSecurity">Security updates (-stable)</a>
  <li><a href="#PkgSig"       >Package signatures</a>
  </ul>
  <li><a href="#Problems"     >Reporting problems</a>
  <li><a href="#Helping"      >Helping us</a>
</ul>

<hr>

<h2 id="Intro">Introduction</h2>

There are many applications one might want to use on an OpenBSD system.
To make this software easier to install and manage, it is <i>ported</i>
to OpenBSD and packaged.
The aim of the package system is to keep track of which software gets
installed, so that it may be easily updated or removed.
In minutes, a large number of packages can be fetched and installed, with
everything put in the right place.

<p>
The ports collection does <b>not</b> go through the same thorough security
audit that is performed on the OpenBSD base system.
Although we strive to keep the quality of the packages high, we just do not
have enough resources to ensure the same level of robustness and security.

<p>
In general, you are advised to use packages over building an application
from ports.
The OpenBSD ports team considers packages to be the goal of their porting
work, not the ports themselves.

<h2 id="PkgMgmt">Package management</h2>

<h3 id="PkgHow">How does it work?</h3>

Packages can be easily managed with the help of several utilities:

<ul>
  <li><a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a>
  - for installing and upgrading packages
  <li><a href="http://man.openbsd.org/pkg_check">pkg_check(8)</a>
  - for checking the consistency of installed packages
  <li><a href="http://man.openbsd.org/pkg_create">pkg_create(1)</a>
  - for creating packages
  <li><a href="http://man.openbsd.org/pkg_delete">pkg_delete(1)</a>
  - for removing installed packages
  <li><a href="http://man.openbsd.org/pkg_info">pkg_info(1)</a>
  - for displaying information about packages
</ul>

In order to run properly, application X may require that other applications
Y and Z be installed.
Application X is said to be dependent on these other applications, which is
why Y and Z are called <i>dependencies</i> of X.
In turn, Y may require other applications P and Q, and Z may require
application R to function properly.
This way, a whole dependency tree is formed.

<p>
Packages look like simple <tt>.tgz</tt> bundles.
Basically they are just that, but there is one crucial difference:
they contain some extra <i>packing information</i>.
This information is used by
<a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a> for several purposes:

<ul>
  <li>Different checks: has the package already been installed, or does it
      conflict with other installed packages or file names?
  <li>Dependencies which are not yet present on the system are automatically
      fetched and installed before proceeding with the installation of the
      package.
  <li>Information about the package(s) is recorded in a central repository,
      by default located in <tt>/var/db/pkg/</tt>.
      This will, among other things, prevent the dependencies of a package
      from being deleted before the package itself has been deleted.
      This helps ensure that an application cannot be accidentally broken
      by a careless user.
</ul>

<h3 id="Mirror">Selecting a mirror</h3>

You can make things easy by defining your preferred
<a href="../ftp.html">mirror</a> in the <tt>PKG_PATH</tt> environment variable
or <a href="http://man.openbsd.org/OpenBSD-6.0/pkg.conf">pkg.conf(5)</a> file.

<p>
<b>Example 1:</b> fetching packages with <tt>PKG_PATH</tt>:

<blockquote><pre>
# <b>export PKG_PATH=http://a.local.mirror/$(uname -r)/packages/$(uname -p)/</b>
# <b>pkg_add irssi</b>
</pre></blockquote>

It's a good idea to add a similar "export" line to your <tt>~/.profile</tt>.
If you're using <a href="http://man.openbsd.org/doas">doas(1)</a>, note that
you will need to pass <tt>setenv { PKG_PATH }</tt> in the config file for
this variable to stick.
You can specify multiple locations, separated by colons.
If the first entry in <tt>PKG_PATH</tt> fails, the next one will be tried, and
so on, until the package is found.
If all entries fail, an error is produced.

<p>
The <tt>-r</tt> and <tt>-p</tt> flags to
<a href="http://man.openbsd.org/uname">uname(1)</a> will expand to the version
of OpenBSD you're running and your CPU architecture.
If you are using snapshots, replace "$(uname -r)" with "snapshots" instead.

<p>
<b>Example 2:</b> fetching packages with
<a href="http://man.openbsd.org/OpenBSD-6.0/pkg.conf">pkg.conf(5)</a>:

<blockquote><pre>
# <b>echo 'installpath = a.local.mirror' > /etc/pkg.conf</b>
# <b>pkg_add mutt</b>
</pre></blockquote>

This assumes that <tt>a.local.mirror</tt> uses the standard
"/pub/OpenBSD/VERSION/packages/ARCH" directory layout, which most mirrors do.
Unlike <tt>PKG_PATH</tt>, this method doesn't rely on the environment, so it
can be a bit easier to manage when things like X sessions are involved.
Note that OpenBSD also includes a list of package mirrors in the
<tt>/etc/examples/pkg.conf</tt> file by default.

<h3 id="PkgFind">Finding packages</h3>

A large collection of pre-compiled packages is available for the most common
architectures.
To search for any given package name, use the <tt>-Q</tt> flag of
<a href="http://man.openbsd.org/pkg_info">pkg_info(1)</a>.

<blockquote><pre>
$ <b>pkg_info -Q unzip</b>
lunzip-1.8
unzip-6.0p9
unzip-6.0p9-iconv
</pre></blockquote>

You will notice that certain packages are available in a few different
varieties -- these are called <b>flavors</b>.
These will be detailed <a href="#PortsFlavors">later on</a>, but flavor
basically means they're configured with different sets of options.
For example, a package might have optional database support, support for
systems without X11, etc.
Some packages are also divided into <b>subpackages</b> that may be
installed separately.

<p>
Not all possible packages are necessarily available on the mirror servers.
Some applications simply don't work on all architectures.
Some applications cannot be distributed via mirrors for licensing reasons.

<p>
If you're looking for a specific filename, install the <tt>pkglocatedb</tt>
package, then use the <tt>pkg_locate</tt> command to find which package(s)
contain that file.

<h3 id="PkgInstall">Installing new packages</h3>

The <a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a> utility is used
to install packages.
If multiple flavors of a package exist, you will be prompted to choose which
one you want to install.

<blockquote><pre>
# <b>pkg_add rsync</b>
Ambiguous: choose package for rsync
a       0: &lt;None&gt;
        1: rsync-3.1.2p0
        2: rsync-3.1.2p0-iconv
Your choice:
</pre></blockquote>

Here you would select <b>1</b> if you want the standard package or <b>2</b>
if you need iconv support.

<p>
It is possible to specify multiple package names on one line, which then
all get installed at once, along with their dependencies.
You may also specify the absolute location of a package, be it a local
file or remote URL.
Supported URL prefixes are http, https, ftp and scp.

<p>
For some packages, important additional information will be given about
the configuration or use of the application.

<blockquote><pre>
# <b>pkg_add jove</b>
jove-4.16.0.73p0: ok
--- +jove-4.16.0.73p0 -------------------
See /usr/local/share/jove/README about changes to /etc/rc or
/etc/rc.local so that the system recovers jove files
on reboot after a system crash
</pre></blockquote>

Additionally, some packages provide configuration and other information
in a file located in <tt>/usr/local/share/doc/pkg-readmes</tt>.

<p>
For your safety, if you are installing a package which you had installed
earlier and removed, configuration files which have been modified will
not be overwritten.
The same is true for when you upgrade a package.

<p>
Sometimes you may encounter an error like the one in the following
example:

<blockquote><pre>
# <b>pkg_add xv</b>
xv-3.10ap4:jpeg-6bp3: ok
xv-3.10ap4:png-1.2.14p0: ok
xv-3.10ap4:tiff-3.8.2p0: ok
Can't install xv-3.10ap4: lib not found X11.9.0
Even by looking in the dependency tree:
        tiff-3.8.2p0, jpeg-6bp3, png-1.2.14p0
Maybe it's in a dependent package, but not tagged with @lib ?
(check with pkg_info -K -L)
</pre></blockquote>

The packing information bundled in the package includes information
about shared libraries that the package expects to be installed.
If one of the required libraries can't be found, the package is not
installed because it would not function anyway.
To solve this type of conflict, you must find out what to install
in order to get the required libraries on your system.

<p>
There are several things to check:
<ul>
<li>You may have older packages installed: an older version of the
required library is present.
In this case, upgrade these packages.
<li>Your system may be incomplete: you did not install one of the
file sets that contains the required library.
Just <a href="faq4.html#FilesNeeded">add the required file set</a>.
<li>Your system may be out of date: you have an older version of the
required library.
Boot the installer (as detailed on <a href="faq4.html">this page</a>),
and choose to (U)pgrade your complete system.
</ul>

<h3 id="PkgUpdate">Updating installed packages</h3>

Let's say you had an older version of unzip installed before upgrading this
box to the latest OpenBSD release.
You can easily upgrade the package to the newer version like this:

<blockquote><pre>
# <b>pkg_add -u unzip</b>
unzip-5.52->unzip-5.52p0: ok
Read shared items: ok
</pre></blockquote>

When a package has dependencies, they are also examined for updates.
Invoking <a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a> with
only the <tt>-u</tt> flag will try to update all installed packages.
A mirror must be <a href="#Mirror">properly configured</a> for this to work.

<h3 id="PkgRemove">Removing installed packages</h3>

To remove a package, simply take the name of the package and use
<a href="http://man.openbsd.org/pkg_delete">pkg_delete(1)</a>.

<blockquote><pre>
# <b>pkg_delete screen</b>
screen-4.0.3p3: ok
Read shared items: ok
--- screen-4.0.3p3 -------------------
You should also remove /etc/screenrc (which was modified)
</pre></blockquote>

Again, modified configuration files will not be removed.

<h3 id="PkgPartial">Incomplete package installation or removal</h3>

In some odd cases, you may find a package was not added or deleted completely,
due to conflicts with other files.
The incomplete installation is usually marked with "partial-" prepended to
the package name.
This can, for instance, happen when you coincidentally press CTRL+C during
installation.
It's always a good idea to remove partial packages from your system, and to
fix potential problems that lead to this failure.
The <a href="http://man.openbsd.org/pkg_check">pkg_check(8)</a> utility can
help clean things up.

<h2 id="Ports">Working with ports</h2>

The ports tree is meant for advanced users.
<b>Everyone is encouraged to use the pre-compiled binary packages.</b>
If you have questions about the ports tree, it is assumed that you have
read the manual pages and this FAQ, and that you are able to work with it.

<h3 id="PortsHow">How does it work?</h3>

The ports tree is a set of Makefiles, one for each third party application,
that controls:

<ul>
  <li>Where and how to fetch the source of the software
  <li>Which other software it depends upon
  <li>How to alter the sources (if necessary)
  <li>How to configure and build it
  <li>How to test it (optional)
  <li>How to install it
</ul>

Apart from the Makefile, each port also contains at least the following:

<ul>
  <li><tt>PLIST</tt> - instructions for package creation once the application
      has been built
  <li><tt>DESCR</tt> - description of the application
  <li><tt>distinfo</tt> - distribution file checksums and size
</ul>

All this information is kept in a directory hierarchy under <tt>/usr/ports</tt>.
This hierarchy contains three special subdirectories:

<ul>
  <li><tt>distfiles/</tt> - where software distribution sets are stored
      after downloading
  <li><tt>infrastructure/</tt> - all the necessary scripts and makefiles
      for the ports infrastructure
  <li><tt>packages/</tt> - binary packages built by the ports system
</ul>

The other subdirectories all form different application categories,
which contain the subdirectories of the actual ports.
Complex ports may be organized to an even deeper level, for example if
they have a core part and a set of extensions, or a stable and a snapshot
version of the application.
Every port directory must contain a <tt>pkg/</tt> subdirectory with
packing list(s) and description file(s).
There may also be <tt>patches/</tt> and <tt>files/</tt> subdirectories,
for source patches and additional files, respectively.

<p>
When a user issues <a href="http://man.openbsd.org/make">make(1)</a>
in the subdirectory of a specific port, the system will recursively
walk its dependency tree, check whether the required dependencies are
installed, build and install any missing dependencies, and then
continue the build of the desired port.
All of the building happens inside the <i>working directory</i> that
the port creates.
Normally this is under <tt>${WRKOBJDIR}</tt>, defaulting to
<tt>/usr/ports/pobj</tt>, but you may override this (see
<a href="#PortsConfig">configuration of the ports system</a>).

<p>
The ports tree is tied to OpenBSD's <a href="faq5.html#Flavors">flavors</a>.
Do not check out a -current ports tree and expect it to work on a -release
or -stable system.
<b>If you follow -current, you need both a -current base system and a -current
ports tree</b>.
Because no intrusive changes are made in -stable, it is possible to use
a -stable ports tree on a -release system and vice versa.

<p>
Another common failure is a missing X11 installation.
Even if the port you try to build has no direct dependency on X11, a
subpackage of it or its dependencies may require X11 headers and libraries.
<b>Building ports on systems without X11 is not supported</b>.

<p>
More information about the ports system may be found in these man pages:

<ul>
  <li><a href="http://man.openbsd.org/ports">ports(7)</a>
  - describes the different stages (make targets) of port installation,
  the use of flavors and subpackages and some other options.
  <li><a href="http://man.openbsd.org/bsd.port.mk">bsd.port.mk(5)</a>
  - in-depth information about all the make targets, variables, the fake
  (installation directory) framework, etc.
</ul>

<h3 id="PortsFetch">Fetching the ports tree</h3>

Once you have decided which flavor of the ports tree you want, you can
get it from different sources.
The table below gives an overview of where you can find the different
flavors, and in which form.
An 'o' marks availability and '-' means it is not available through
that specific source.

<p>
<table border="1" align="center" style="empty-cells: show;">
<tr align="center">
<td align="left">Source</td>
<td>Form</td>
<td colspan="4">Flavor</td>
</tr>
<tr align="center">
<td colspan="2"></td>
<td>-release</td>
<td>-stable</td>
<td>snapshots</td>
<td>-current</td>
</tr>
<tr align="center">
<td align="left"><a href="../ftp.html">Mirrors</a></td>
<td>.tar.gz</td>
<td>o</td>
<td>-</td>
<td>o</td>
<td>-</td>
</tr>
<tr align="center">
<td align="left"><a href="../anoncvs.html">AnonCVS</a></td>
<td>cvs checkout</td>
<td>o</td>
<td>o</td>
<td>-</td>
<td>o</td>
</tr>
</table>

<p>
Look for a file named <tt>ports.tar.gz</tt> on the mirrors.

<blockquote><pre>
$ <b>cd /tmp</b>
$ <b>ftp https://ftp.openbsd.org/pub/OpenBSD/$(uname -r)/{ports.tar.gz,SHA256.sig}</b>
$ <b>signify -Cp /etc/signify/openbsd-$(uname -r | cut -c 1,3)-base.pub -x SHA256.sig ports.tar.gz</b>
</pre></blockquote>

You want to untar this file in the <tt>/usr</tt> directory, which will
create <tt>/usr/ports</tt> and all the directories under it.

<blockquote><pre>
# <b>cd /usr</b>
# <b>tar xzf /tmp/ports.tar.gz</b>
</pre></blockquote>

The snapshots available on the mirrors are generated daily from the -current
ports tree.
You will find the snapshots in the <tt>/pub/OpenBSD/snapshots/</tt> directory.
If you are using a snapshot of the ports tree, you should have installed
a matching snapshot of OpenBSD.
Make sure you keep your ports tree and your OpenBSD system in sync!

<p>
For more information about obtaining the ports tree via CVS, read the
<a href="../anoncvs.html">AnonCVS page</a>, which contains a list of
available servers and a number of examples.

<h3 id="PortsConfig">Configuration of the ports system</h3>

This section introduces some additional global settings for building ports.
You can skip it, but then you will be required to perform many of the
<a href="http://man.openbsd.org/make">make(1)</a> statements in later
examples as root.

<p>
Because the OpenBSD project does not have the resources to fully review
the source code of all software in the ports tree, you can configure the
ports system to take a few safety precautions.
The ports infrastructure is able to perform all building as a regular user,
and perform only those steps that require superuser privileges as root
(for example, the <tt>install</tt> make target).
However, because root privileges are always required at some point,
the ports system will not save you when you decide to build a malicious
application.

<ul>
  <li>You can set up <a href="http://man.openbsd.org/doas">doas(1)</a> and
      have the ports system use it for tasks requiring superuser permissions.
      This requires granting two permissions:
      <ul>
        <li>The user who is going to build ports needs permission to run
            arbitrary commands as the superuser and pass certain environment
            variables to the privileged shell.
            See the <tt>setenv</tt> and <tt>keepenv</tt> options in
            <a href="http://man.openbsd.org/doas.conf">doas.conf(5)</a>.
        <li>The ports system needs permission to invoke
            <a href="http://man.openbsd.org/doas">doas(1)</a>.
            This can be granted by setting the <tt>SUDO</tt> variable defined
            in <a href="http://man.openbsd.org/bsd.port.mk">bsd.port.mk(5)</a>,
            which can be made permanent by adding <tt>SUDO=/usr/bin/doas</tt>
            to <a href="http://man.openbsd.org/mk.conf">mk.conf(5)</a>.
       </ul>

  <li>You can modify the ownership of the ports tree so that you can write
      there as a regular user.
      In this case, an example user has been added to the <tt>wsrc</tt> group
      and the underlying directories are made group-writable.

<blockquote><pre>
# <b>user mod -G wsrc exampleuser</b>
# <b>chgrp -R wsrc /usr/ports</b>
# <b>find /usr/ports -type d -print0 | xargs -0r chmod g+w</b>
</pre></blockquote>
</ul>

It is possible to use a read-only ports tree by separating directories
that are written to during port building:

<ul>
  <li>The working directory of ports.
  This is controlled by the <tt>WRKOBJDIR</tt> variable, which specifies
  the directory which will contain the working directories.
  <li>The directory containing distribution files.
  This is controlled by the <tt>DISTDIR</tt> variable.
  <li>The directory containing newly built binary packages.
  This is controlled by the <tt>PACKAGE_REPOSITORY</tt> variable.
</ul>

For example, you could add the following lines to <tt>/etc/mk.conf</tt>:

<blockquote><pre>
WRKOBJDIR=/usr/obj/ports
DISTDIR=/usr/distfiles
PACKAGE_REPOSITORY=/usr/packages
</pre></blockquote>

If desired, you can also change the ownership of these directories to your
local username and group, so that the ports system can create the underlying
working directories as a regular user.
Again, ports can be <i>built</i> as a user, but must be <i>installed</i>
by root or with <a href="http://man.openbsd.org/doas">doas(1)</a>.

<h3 id="PortsSearch">Searching the ports tree</h3>

Once you have the ports tree in place on your system, it becomes very easy
to search for software.
Just use <tt>make search key="searchkey"</tt> as shown in this example:

<blockquote><pre>
$ <b>cd /usr/ports</b>
$ <b>make search key=rsnapshot</b>
Port:   rsnapshot-1.3.1p0
Path:   net/rsnapshot
Info:   remote filesystem snapshot utility
Maint:  Antoine Jacoutot &lt;ajacoutot@openbsd.org&gt;
Index:  net sysutils
L-deps:
B-deps: :net/rsync
R-deps: :devel/p5-Lchown :net/rsync
Archs:  any
</pre></blockquote>

The search result gives a nice overview of each application that is found:
the port name, the path to the port, a one-line description, the port's
maintainer, keywords related to the port, library/build/runtime dependencies,
and architectures on which the port is known to work.

<p>
This mechanism, however, is a very basic one, which just runs awk(1)
on the ports index file.
A port called "sqlports" allows very fine-grained searching using SQL.
It is an SQLite database, but just about any database format can be created
using the ports infrastructure.
The <tt>sqlports</tt> port includes the script used to generate the database,
which could be used as a basis to generate databases in different formats.

<p>
Just install the <tt>sqlports</tt> package to get started.
A sample session could look like this:

<blockquote><pre>
$ <b>sqlite3 /usr/local/share/sqlports</b>
SQLite version 3.3.12
Enter ".help" for instructions
sqlite> SELECT FULLPKGNAME,COMMENT FROM Ports WHERE COMMENT LIKE '%statistics%';
Guppi-0.40.3p1|GNOME-based plot program with statistics capabilities
mailgraph-1.12|a RRDtool frontend for Postfix statistics
R-2.4.1|clone of S, a powerful math/statistics/graphics language
py-probstat-0.912p0|probability and statistics utilities for Python
darkstat-3.0.540p1|network statistics gatherer with graphs
pfstat-2.2p0|packet filter statistics visualization
tcpstat-1.4|report network interface statistics
wmwave-0.4p2|Window Maker dockapp to display wavelan statistics
diffstat-1.43p0|accumulates and displays statistics from a diff file
sqlite>
</pre></blockquote>

The above is still a very basic search.
With SQL, just about anything can be searched for, including dependencies,
configure flags, shared libraries, etc.

<h3 id="PortsInstall">Straightforward installation: a simple example</h3>

For clarity's sake, let's consider a simple example: rsnapshot.
This application has one dependency: rsync.
The following commands assume you've configured the <tt>SUDO</tt>
varable in <tt>/etc/mk.conf</tt> as mentioned above.

<blockquote><pre>
$ <b>cd /usr/ports/net/rsnapshot</b>
$ <b>make install</b>
===>  Checking files for rsnapshot-1.2.9
&gt;&gt; rsnapshot-1.2.9.tar.gz doesn't seem to exist on this system.
&gt;&gt; Fetch http://www.rsnapshot.org/downloads/rsnapshot-1.2.9.tar.gz.
100% |**************************************************|   173 KB    00:02
&gt;&gt; Size matches for /usr/ports/distfiles/rsnapshot-1.2.9.tar.gz
&gt;&gt; Checksum OK for rsnapshot-1.2.9.tar.gz. (sha1)
===&gt;  rsnapshot-1.2.9 depends on: rsync-2.6.9 - not found
===&gt;  Verifying install for rsync-2.6.9 in net/rsync
===&gt;  Checking files for rsync-2.6.9
&gt;&gt; rsync-2.6.9.tar.gz doesn't seem to exist on this system.
&gt;&gt; Fetch ftp://ftp.samba.org/pub/rsync/old-versions/rsync-2.6.9.tar.gz.
100% |**************************************************|   792 KB    00:31
&gt;&gt; Size matches for /usr/ports/distfiles/rsync-2.6.9.tar.gz
&gt;&gt; Checksum OK for rsync-2.6.9.tar.gz. (sha1)
===&gt;  Verifying specs:  c
===&gt;  found c.40.3
===&gt;  Extracting for rsync-2.6.9
===&gt;  Patching for rsync-2.6.9
===&gt;  Configuring for rsync-2.6.9
  [...]
===&gt;  Building for rsync-2.6.9
  [...]
===&gt;  Faking installation for rsync-2.6.9
  [...]
===&gt;  Building package for rsync-2.6.9
Link to /usr/ports/packages/i386/ftp/rsync-2.6.9.tgz
Link to /usr/ports/packages/i386/cdrom/rsync-2.6.9.tgz
===&gt;  Installing rsync-2.6.9 from /usr/ports/packages/i386/all/rsync-2.6.9.tgz
rsync-2.6.9: ok
===&gt; Returning to build of rsnapshot-1.2.9
===&gt;  rsnapshot-1.2.9 depends on: rsync-2.6.9 - found
===&gt;  Extracting for rsnapshot-1.2.9
===&gt;  Patching for rsnapshot-1.2.9
===&gt;  Configuring for rsnapshot-1.2.9
  [...]
===>  Building for rsnapshot-1.2.9
  [...]
===&gt;  Faking installation for rsnapshot-1.2.9
  [...]
===&gt;  Building package for rsnapshot-1.2.9
Link to /usr/ports/packages/i386/ftp/rsnapshot-1.2.9.tgz
Link to /usr/ports/packages/i386/cdrom/rsnapshot-1.2.9.tgz
===&gt;  rsnapshot-1.2.9 depends on: rsync-2.6.9 - found
===&gt;  Installing rsnapshot-1.2.9 from /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
rsnapshot-1.2.9: ok
</pre></blockquote>

<p>
As you can see, the ports system is doing many things automatically.
It will fetch, extract, and patch the source code, configure and build
(compile) the source, install the files into a fake directory, create
a package (corresponding to the packing list) and install this package
onto your system (usually under <tt>/usr/local/</tt>).
And it does this recursively <b>for all dependencies</b> of the port.
Notice the
"<tt>===&gt; Verifying install for ...</tt>" and
"<tt>===&gt; Returning to build of ...</tt>" lines in the above output,
indicating the walk through the dependency tree.

<p>
If a previous version of the application you want to install was already
installed on your system, you can use <tt>make update</tt> instead of
<tt>make install</tt>.
This will call <a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a>
with the <tt>-r</tt> flag.

<p>
Large applications will require a lot of system resources to build.
If you get "out of memory" type of errors when building such a port,
this usually has one of two causes:

<ul>
  <li>Your resource limits are too restrictive.
      Adjust them with ksh's <tt>ulimit</tt> or csh's <tt>limit</tt> command.
  <li>You simply don't have enough RAM.
</ul>

<h3 id="PortsClean">Cleaning up after a build</h3>

You probably want to clean the port's default working directory after
you have built the package and installed it.

<blockquote><pre>
$ <b>make clean</b>
===&gt;  Cleaning for rsnapshot-1.2.9
</pre></blockquote>

In addition, you can also clean the working directories of all
dependencies of the port with this make target:

<blockquote><pre>
$ <b>make clean=depends</b>
===&gt;  Cleaning for rsync-2.6.9
===&gt;  Cleaning for rsnapshot-1.2.9
</pre></blockquote>

If you wish to remove the source distribution set(s) of the port, you
would use:

<blockquote><pre>
$ <b>make clean=dist</b>
===&gt;  Cleaning for rsnapshot-1.2.9
===&gt;  Dist cleaning for rsnapshot-1.2.9
</pre></blockquote>

In case you have been compiling multiple flavors of the same port,
you can clear the working directories of all these flavors at once using:

<blockquote><pre>
$ <b>make clean=flavors</b>
</pre></blockquote>

You can also clean things up as they get built by setting a special variable.
Work directories will automatically be cleaned after packages have been
created.

<blockquote><pre>
$ <b>make package BULK=Yes</b>
</pre></blockquote>

<h3 id="PortsDelete">Uninstalling a port's package</h3>

It is very easy to uninstall a port:

<blockquote><pre>
$ <b>make uninstall</b>
===&gt; Deinstalling for rsnapshot-1.2.9
rsnapshot-1.2.9: ok
Read shared items: ok
</pre></blockquote>

This will call <a href="http://man.openbsd.org/pkg_delete">pkg_delete(1)</a>
to have the corresponding package removed from your system.
If desired, you can also uninstall and reinstall a port's package by using:

<blockquote><pre>
$ <b>make reinstall</b>
===&gt;  Cleaning for rsnapshot-1.2.9
/usr/sbin/pkg_delete rsnapshot-1.2.9
rsnapshot-1.2.9: ok
===&gt;  Installing rsnapshot-1.2.9 from /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
rsnapshot-1.2.9: ok
</pre></blockquote>

If you would like to get rid of the packages you just built, you can do so
as follows:

<blockquote><pre>
$ <b>make clean=packages</b>
===&gt;  Cleaning for rsnapshot-1.2.9
rm -f /usr/ports/packages/i386/all/rsnapshot-1.2.9.tgz
</pre></blockquote>

<h3 id="PortsFlavors">Using flavors and subpackages</h3>

Please read the
<a href="http://man.openbsd.org/ports">ports(7)</a>
man page, which gives a good overview of this topic.
There are two mechanisms to control the packaging of software according
to different needs.

<p>
The first mechanism is called <b>flavors</b>.
A flavor usually indicates a certain set of compilation options.
For instance, some applications have a "no_x11" flavor which can be used on
systems without X.
Some shells have a "static" flavor that will build a statically linked
version.
There are ports which have different flavors for building them with
different graphical toolkits.
Other examples include support for different database formats,
different networking options (SSL, IPv6, ...), different paper sizes, etc.

<p>
<b>Summary:</b>
You will most likely use flavors when a package has not been made available
for the flavor you are looking for.
In this case, you can specify the desired flavor and build the port yourself.

<p>
Most port flavors have their own working directory during compilation,
and every flavor will be packaged into a correspondingly-named package to
avoid any confusion.
To see the different flavors of a certain port, you would change to its
subdirectory and issue:

<blockquote><pre>
$ <b>make show=FLAVORS</b>
</pre></blockquote>

You can also look at the port's <tt>DESCR</tt> files, which explain the
available flavors in more detail.

<p>
The second mechanism is called <b>subpackages</b>.
A porter may decide to create subpackages for different pieces of the
same application if they can be logically separated.
You will often see subpackages for the client part and the server part
of a program.
Sometimes extensive documentation is bundled in a separate subpackage
because it takes up a lot of disk space.
Extra functionality that pulls in heavy dependencies will often be
packaged separately.
The porter will also decide which subpackage is the main subpackage,
to be installed as a default.
Other examples are extensive test suites which come with the software,
separate modules with support for different things, etc.

<p>
<b>Summary:</b>
Some ports are split into several packages. <tt>make install</tt> will only
install the main subpackage.

<p>
To list the different packages built by a port, use:

<blockquote><pre>
$ <b>make show=PKGNAMES</b>
</pre></blockquote>

<tt>make install</tt> will only install the main subpackage.
To install them all, use:

<blockquote><pre>
$ <b>make install-all</b>
</pre></blockquote>

To list the different subpackages available for a port, use:

<blockquote><pre>
$ <b>make show=MULTI_PACKAGES</b>
</pre></blockquote>

It is possible to select which subpackage(s) to install from within the
ports tree.
After some tests, this procedure will just call
<a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a>
to install the desired subpackage(s).

<blockquote><pre>
# <b>env SUBPACKAGE="-server" make install</b>
</pre></blockquote>

The subpackages mechanism only handles packages.
It does not modify any configuration options before building the port.
You must use flavors for that purpose.

<h3 id="dpb">Using dpb to build multiple ports</h3>

When you need to build more than one or two ports at a time, you can
use the <tt>/usr/ports/infrastructure/bin/dpb</tt> tool.

<a href="http://man.openbsd.org/dpb">dpb(1)</a> takes a list of ports to build
and automatically builds them all in an optimal order, making use of as much
parallelism as possible.
It can also use multiple machines to perform the building, and produces
detailed logs of the build process for troubleshooting, placed in
<tt>/usr/ports/log</tt> by default.

<blockquote><pre>
# <b>/usr/ports/infrastructure/bin/dpb -P ~/localports</b>
</pre></blockquote>

This command will read the list of
<a href="http://man.openbsd.org/pkgpath">pkgpaths</a> in <tt>~/localports</tt>
and build all the packages.
It can also install the packages after they have been built.
The <tt>~/localports</tt> file might look something like this:

<blockquote><pre>
net/rsync
www/mozilla-firefox
editors/vim
</pre></blockquote>

If you do not provide a list of ports to build on the command line or via
<tt>-P</tt> or <tt>-I</tt>, <a href="http://man.openbsd.org/dpb">dpb(1)</a>
will build all the ports in the ports tree.
If run as root, dpb will automatically drop privileges to dedicated users
for fetching distfiles and building ports.
This is the recommended way to use it, but it can also run as a regular user.
Additionally, the <a href="http://man.openbsd.org/proot">proot(1)</a> utility
can be used to further isolate building operations.

<h3 id="PortsSecurity">Security updates (-stable)</h3>

When serious bugs or security flaws are discovered in third party software,
they are fixed in the <i>-stable</i> branch of the ports tree.
Note that <b>binary packages for -release and -stable are not updated</b>.
In contrast to the base system, the -stable ports tree only gets security
backports for the latest release.

<p>
This means that all you need to do is make sure you check out the correct
branch of the ports tree, and build the desired software from it.
You can keep your tree up to date with <a href="../anoncvs.html">CVS</a>
and subscribe to the ports-changes <a href="../mail.html">mailing list</a>
to receive security announcements related to software in the ports tree.

<p>
Of course, security updates reach the <i>-current</i> ports tree before
being taken up in the <i>-stable</i> branch.

<h3 id="PkgSig">Package signatures</h3>

Signatures are a good way to make sure packages are legitimate and not
corrupted.
OpenBSD offers official signed packages using
<a href="http://man.openbsd.org/signify">signify(1)</a>.
No extra effort is needed on the user's part to ensure packages haven't
been tampered with.

<p>
If you want to build <i>your own</i> signed packages, you'll first need
to create keys for signing.

<blockquote><pre>
# <b>signify -Gns /etc/signify/my-pkg.sec -p /etc/signify/my-pkg.pub</b>
</pre></blockquote>

Note the names: keys for signing packages should end in <tt>pkg</tt>.

<p>
Then we may sign existing packages after building them with
<!-- XXXrelease - pkg_sign -s flag arguments changed -->
<a href="http://man.openbsd.org/OpenBSD-6.0/pkg_sign">pkg_sign(1)</a>.

<blockquote><pre>
# <b>cd /usr/ports/packages/$(uname -p)</b>
# <b>pkg_sign -s signify -s /etc/signify/my-pkg.sec -o signed -S all</b>
</pre></blockquote>

Alternately, we may add the following line to <tt>/etc/mk.conf</tt> to
directly build signed packages by default:

<blockquote><pre>
SIGNING_PARAMETERS=-s signify -s /etc/signify/my-pkg.sec
</pre></blockquote>

In order to install the package on another machine, the public key
<tt>my-pkg.pub</tt> should be put into the <tt>/etc/signify</tt> directory
on that machine.

<h2 id="Problems">Reporting problems</h2>

If you have trouble with an existing port, please send an email to the
port maintainer.
To see who is the maintainer of the port, type, for example:

<blockquote><pre>
$ <b>cd /usr/ports/archivers/unzip</b>
$ <b>make show=MAINTAINER</b>
</pre></blockquote>

Alternatively, if there is no maintainer, or you can't reach them, send an
email to the <a href="mailto:ports@openbsd.org">ports@openbsd.org</a>
mailing list.
Please do NOT use the misc@openbsd.org mailing list for questions
about ports.

<p>
In any case, please provide:

<ul>
  <li>Your OpenBSD version, including any patches you may have applied.
  The kernel version is given by: <tt>sysctl -n kern.version</tt>
  <li>The version of your ports tree: if the file <tt>/usr/ports/CVS/Tag</tt>
  exists, provide its contents.
  If this file is absent, you are using the -current ports tree.
  <li>A complete description of the problem.
  Don't be afraid to provide details.
  Mention all the steps you followed before the problem occurred.
  Is the problem reproducible?
  The more information you provide, the more likely you will get help.
</ul>

For ports which do not build correctly, a complete build transcript is
almost always required.
You can use the <tt>portslogger</tt> script, found in
<tt>/usr/ports/infrastructure/bin</tt>, for this.
A sample run might look like this:

<blockquote><pre>
$ <b>mkdir ~/portlog</b>
$ <b>cd /usr/ports/archivers/unzip</b>
$ <b>make 2&gt;&amp;1 | /usr/ports/infrastructure/bin/portslogger ~/portlog</b>
</pre></blockquote>

After this, you should have a logfile of the build in your <tt>~/portlog</tt>
directory that you can send to the port maintainer.
Also, make sure you are not using any special options in your build,
for example in <tt>/etc/mk.conf</tt>.

<p>
Alternatively, you can:

<ul>
  <li>Use <a href="http://man.openbsd.org/script">script(1)</a> to create
      a complete build transcript.
  <li>Attach the output of
  <a href="http://man.openbsd.org/pkg_info">pkg_info(1)</a>
  if it seems even remotely relevant.
  <li><a href="http://man.openbsd.org/gcc">gcc(1)</a>
  internal compiler errors ask you to report the bug to the gcc
  mailing list.
  It does save time if you follow their direction, and provide at least
  the various files produced by <tt>gcc -save-temps</tt>.
</ul>

<h2 id="Helping">Helping us</h2>

There are many ways you can help.
They are listed below, by increasing order of difficulty.

<ul>
  <li><a href="#Problems">Report problems</a> as you experience them.
  <li>You can systematically test ports and report breakages, or suggest
  improvements.
  Just have a look at the <a href="ports/testing.html">Port Testing Guide</a>.
  You <b>must run a -current system</b> for creating and testing ports.
  <li>Test the updates to ports which are posted to the ports mailing list.
  <li>Send updates or patches to a port's maintainer, or to the ports
  mailing list if the port has no maintainer.
  Generally this is highly appreciated, unless your patches will cause
  developers to waste time rather than save time.
  <li>Create new ports.
  If you are really eager and want to know everything about porting
  applications to OpenBSD, a good starting point is the
  <a href="ports/index.html">OpenBSD Porter's Handbook</a>.
</ul>

<p>
<a href="../want.html">Hardware</a> donations can assist
testing ports on the various <a href="../plat.html">platforms</a>
OpenBSD runs on.

<p>
</body>
</html>
